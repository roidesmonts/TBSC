define(["jquery"],function($){var prefetcher={prefetch:function(max_parallel,int_msec,url_patterns){var backlog=[],wip=0,i,int_val_id=null,supportedRegex=null,urlRegex=null;if(typeof url_patterns!=="undefined"){supportedRegex="/("+url_patterns.join("|")+")/";urlRegex=new RegExp(supportedRegex,"i")}$("[data-prefetch]").each(function(){if(urlRegex!==null){if(urlRegex.test(this.href))backlog.push(this.href)}else backlog.push(this.href)});function downloadBacklog(){var to_download_nbr;if(int_val_id===
null)int_val_id=window.setInterval(function(){if(backlog.length>0)downloadBacklog();else clearInterval(int_val_id)},int_msec);to_download_nbr=max_parallel-wip;if(to_download_nbr>0)for(i=0;i<to_download_nbr;i++)download_one(backlog[i])}downloadBacklog();function download_one(url){backlog.splice(i,1);wip++;$.get(url,function(){wip--})}}};return prefetcher});
