define(["jquery","lmd/core/conf","lib/jquery/plugin/jquery.cookie"],function($,conf,jqueryCookie){$.cookie=jqueryCookie;var storage={isSupported:false,get:function(key,session){var stockData,storageValue;if(this.isSupported)try{storageValue=window.localStorage.getItem(key);if(storageValue===null||session===true)storageValue=window.sessionStorage.getItem(key);stockData=JSON.parse(storageValue)}catch(e){return null}else stockData=JSON.parse(this._getNoStorage(key));if(!stockData)return null;if(stockData.timeout!==
undefined){var now=(new Date).getTime(),diff=parseInt(stockData.timeout,10)-now;if(diff<0){this.remove(key);return null}}if(stockData.data===undefined)return null;return stockData.data},set:function(key,data,timeout,session){var stockData={};stockData.data=data;if(typeof timeout!=="undefined"&&$.isNumeric(timeout))stockData.timeout=(new Date).getTime()+timeout;var stockDataJson=JSON.stringify(stockData);if(this.isSupported){try{if(typeof timeout!=="undefined"&&session===true)window.sessionStorage.setItem(key,
stockDataJson);else window.localStorage.setItem(key,stockDataJson)}catch(e){return false}return true}return this._setNoStorage(key,stockDataJson,timeout)},remove:function(key,session){if(this.isSupported){if(session){window.sessionStorage.removeItem(key);return true}window.sessionStorage.removeItem(key);window.localStorage.removeItem(key);return true}return this._removeNoStorage(key)},_setNoStorage:function(key,data,timeout){if($.cookie===undefined)return false;var options={path:"/",domain:"."+conf.current.location.domain};
if(typeof timeout==="number"){var expire=Math.floor(timeout/36E5);if(expire>0)options.expires=Math.floor(timeout/36E5)}$.cookie("storage_"+key,data,options);return true},_getNoStorage:function(key){if(typeof $.cookie==="undefined")return false;return $.cookie("storage_"+key)},_removeNoStorage:function(key){if(typeof $.cookie==="undefined")return false;$.cookie("storage_"+key,null);return true}};storage.isSupported=function(){try{return window.sessionStorage!==null&&window.localStorage!==null}catch(e){return false}}();
return storage});
